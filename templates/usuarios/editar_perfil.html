{% extends 'base/base.html' %}
{% load static %}

{% block title %}Editar Perfil - Me Ache{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #FF2E6C;
        --secondary: #0066FF;
        --bg-main: #F9F9FB;
        --bg-card: #FFFFFF;
        --text-primary: #222222;
        --text-secondary: #777777;
        --border-light: #E0E0E0;
        --shadow-light: 0 2px 6px rgba(0,0,0,0.05);
        --shadow-medium: 0 4px 12px rgba(0,0,0,0.1);
        --gradient-primary: linear-gradient(135deg, #FF2E6C, #E91E63);
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg-main);
    }
    
    .edit-container {
        min-height: 100vh;
        padding: 10px 0 20px 0; /* Espaço mínimo para aba fixa */
    }
    
    .edit-header {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: var(--shadow-light);
        text-align: center;
    }
    
    .edit-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
    }
    
    .edit-subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }
    
    /* Header melhorado */
    .header-user-info {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 8px;
    }
    
    .header-photo-container {
        position: relative;
        flex-shrink: 0;
    }
    
    .header-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .header-badges {
        position: absolute;
        top: -5px;
        right: -5px;
        display: flex;
        gap: 5px;
        flex-direction: column;
    }
    
    .badge-vip {
        background: linear-gradient(135deg, #f7b500, #ff8c00);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 2px;
        white-space: nowrap;
    }
    
    .badge-verified {
        background: linear-gradient(135deg, #3ea6ff, #1e90ff);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 2px;
        white-space: nowrap;
    }
    
    .header-user-details {
        flex: 1;
        min-width: 0; /* Permite que o texto quebre */
    }
    
    .header-user-name {
        margin: 0 0 5px 0;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-primary);
        word-wrap: break-word;
    }
    
    .header-user-type {
        color: var(--text-secondary);
        margin: 0 0 8px 0;
        font-size: 1rem;
        word-wrap: break-word;
    }
    
    .header-user-location {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin: 0;
        word-wrap: break-word;
    }
    
    /* Barra de Progresso (igual ao perfil proprietário) */
    .progress-section {
        background: var(--gradient-primary);
        margin: 15px 25px 5px;
        padding: 15px 20px;
        border-radius: 16px;
        color: white;
        text-align: center;
        animation: slideInLeft 0.8s ease-out 0.6s both;
    }
    
    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .progress-message {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 5px 0;
    }
    
    .progress-bar-container {
        background: rgba(255, 255, 255, 0.3);
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
        position: relative;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: white;
        border-radius: 5px;
        transition: width 0.8s ease;
        position: relative;
    }
    
    .progress-bar-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    .progress-percentage {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.8rem;
        font-weight: 700;
        color: var(--primary);
    }
    
    /* Menu horizontal FIXO na tela */
    .tabs-nav-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: var(--bg-card);
        box-shadow: var(--shadow-medium);
        padding: 5px 20px;
        border-bottom: 1px solid var(--border-light);
        margin: 0;
        height: 50px;
    }
    
    .tabs-nav {
        display: flex;
        background: transparent;
        border: none;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        justify-content: center;
        flex-wrap: nowrap;
    }
    
    .tabs-nav::-webkit-scrollbar {
        display: none;
    }
    
    .tab-button {
        flex: 0 0 auto;
        padding: 12px 20px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-weight: 600;
        color: var(--text-secondary);
        transition: all 0.3s ease;
        white-space: nowrap;
        min-width: fit-content;
        border-radius: 25px;
        margin: 0 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .tab-button.active {
        background: var(--gradient-primary);
        color: white;
        transform: translateY(-1px);
        box-shadow: var(--shadow-medium);
    }
    
    .tab-button:hover:not(.active) {
        background: rgba(255, 46, 108, 0.1);
        color: var(--primary);
        transform: translateY(-1px);
    }
    
    .tabs-container {
        background: var(--bg-card);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        margin-bottom: 15px;
        margin-top: 0px;
    }
    
    /* ESPAÇAMENTO LIMPO E SIMPLES */
    .edit-container {
        padding: 20px 0;
    }
    
    .edit-header {
        margin-bottom: 5px;
        padding: 20px;
    }
    
    .progress-section {
        margin: 10px 20px 5px;
        padding: 10px 15px;
    }
    
    .tabs-nav-container {
        margin: 0;
        padding: 10px 20px;
    }
    
    .tabs-container {
        margin: 0;
        padding: 0;
        margin-top: 0;
    }
    
    .tab-content {
        padding: 10px;
        display: none;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    .form-section {
        padding: 5px;
        margin-bottom: 0;
        margin-top: 0;
    }
    
    /* Responsivo para mobile */
    @media (max-width: 768px) {
        .tabs-nav-container {
            padding: 8px 15px;
        }
        
        .tabs-nav {
            flex-wrap: nowrap !important;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tabs-nav::-webkit-scrollbar {
            display: none;
        }
        
        .tab-button {
            flex: 0 0 auto !important;
            min-width: 80px;
            padding: 10px 8px;
            margin: 0 2px;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        .edit-container {
            padding: 70px 0 10px 0; /* Menos espaço no mobile */
        }
    }
    
    .tab-content {
        display: none !important;
        animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
        display: block !important;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .form-section {
        margin-bottom: 20px;
        padding: 20px;
    }
    
    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-icon {
        color: var(--primary);
        font-size: 1.4rem;
    }
    
    .form-group {
        margin-bottom: 3px;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
        display: block;
        font-size: 0.9rem;
    }
    
    .form-control {
        border: 2px solid var(--border-light);
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(255, 46, 108, 0.1);
        outline: none;
    }
    
    .photo-upload {
        text-align: center;
        padding: 40px;
        border: 2px dashed var(--border-light);
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #fafbfc;
    }
    
    .photo-upload:hover {
        border-color: var(--primary);
        background: #fff5f8;
    }
    
    .photo-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--bg-card);
        box-shadow: var(--shadow-medium);
        margin: 0 auto 15px;
    }
    
    .couple-section {
        display: none;
        height: 0;
        overflow: hidden;
        background: #f8fafc;
        border-radius: 15px;
        padding: 0;
        margin: 0;
        border: none;
        transition: all 0.3s ease;
    }
    
    .couple-section.active {
        display: block !important;
        height: auto;
        overflow: visible;
        padding: 15px;
        margin-top: 10px;
        border: 1px solid var(--border-light);
        animation: slideDown 0.3s ease;
    }
    
    /* Novos estilos para a aba informações */
    .info-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 5px;
        margin-bottom: 2px;
        border: 1px solid #e9ecef;
    }
    
    .subsection-title {
        color: #495057;
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 5px;
        padding-bottom: 3px;
        border-bottom: 1px solid #dee2e6;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .subsection-title:hover {
        color: #007bff;
    }
    
    .subsection-title .collapse-icon {
        transition: transform 0.3s ease;
    }
    
    .subsection-title.collapsed .collapse-icon {
        transform: rotate(-90deg);
    }
    
    .subsection-content {
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .subsection-content.collapsed {
        max-height: 0;
        padding-top: 0;
        margin-bottom: 0;
    }
    
    .person-panel {
        display: none;
        height: 0;
        overflow: hidden;
        margin: 0;
        padding: 0;
    }
    
    .person-panel.active {
        display: block;
        height: auto;
        overflow: visible;
        margin: 0;
        padding: 0;
    }
    
    /* Otimização Mobile - 1 campo por linha */
    @media (max-width: 768px) {
        .info-section {
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .subsection-title {
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        /* Forçar 1 campo por linha no mobile */
        .info-section .col-md-4,
        .info-section .col-md-6 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 10px;
        }
        
        /* Reduzir padding dos campos */
        .info-section .form-control {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        /* Seções colapsáveis por padrão no mobile */
        .subsection-content {
            max-height: none;
        }
    }
    
    /* Desktop - manter 2 campos por linha */
    @media (min-width: 769px) {
        .info-section .col-md-4 {
            flex: 0 0 33.333333%;
            max-width: 33.333333%;
            margin-bottom: 10px;
        }
        
        .info-section .col-md-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }
    }
    
    /* Forçar exibição da seção de casal quando necessário */
    #couple-names-section.active,
    #couple-info-section.active {
        display: block !important;
    }
    
    @keyframes slideDown {
        from { opacity: 0; max-height: 0; }
        to { opacity: 1; max-height: 500px; }
    }
    
    /* Controles Mobile para Casal */
    .mobile-tabs-control {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        padding: 0 5px;
    }
    
    .mobile-tab-btn {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid var(--border-light);
        border-radius: 25px;
        background: var(--bg-card);
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .mobile-tab-btn.active {
        background: var(--gradient-primary);
        color: white;
        border-color: var(--primary);
        transform: translateY(-1px);
        box-shadow: var(--shadow-medium);
    }
    
    .mobile-tab-btn:hover:not(.active) {
        border-color: var(--primary);
        color: var(--primary);
        background: rgba(255, 46, 108, 0.1);
    }
    
    .person-panel {
        display: none;
        animation: fadeIn 0.3s ease;
        margin-top: 5px;
    }
    
    .person-panel.active {
        display: block;
        height: auto;
        overflow: visible;
        margin: 0;
        padding: 0;
    }
    
    /* Autocomplete para cidade/estado */
    .autocomplete-container {
        position: relative;
    }
    
    .suggestions-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        width: 100%;
    }
    
    .suggestion-item {
        padding: 12px 16px;
        cursor: pointer;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.2s ease;
    }
    
    .suggestion-item:hover {
        background-color: #f8fafc;
    }
    
    .suggestion-item:last-child {
        border-bottom: none;
    }
    
    .suggestion-city {
        font-weight: 500;
        color: var(--text-primary);
    }
    
    .suggestion-state {
        font-size: 0.9rem;
        color: var(--text-secondary);
        background: var(--primary);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
    }
    
    .couple-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .couple-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .person-block {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-light);
    }
    
    .person-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        text-align: center;
        padding: 8px;
        border-radius: 8px;
        background: var(--primary);
        color: white;
    }
    
    .interests-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .interest-category {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-light);
    }
    
    .category-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .category-icon {
        color: var(--primary);
    }
    
    .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
    }
    
    .form-check {
        padding: 8px 0;
    }
    
    .form-check-input {
        margin-right: 10px;
    }
    
    .form-check-label {
        font-weight: 500;
        color: var(--text-primary);
        cursor: pointer;
    }
    
    .bio-counter {
        text-align: right;
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-top: 5px;
    }
    
    .bio-counter.warning {
        color: #f59e0b;
    }
    
    .bio-counter.danger {
        color: #ef4444;
    }
    
    .save-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: all 0.3s ease;
        z-index: 999;
    }
    
    .save-button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
    }
    
    .save-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    
    .alert {
        border-radius: 12px;
        border: none;
        padding: 15px 20px;
        margin-bottom: 20px;
    }
    
    .alert-success {
        background: #d1fae5;
        color: #065f46;
    }
    
    .alert-danger {
        background: #fee2e2;
        color: #991b1b;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
        .couple-grid {
            grid-template-columns: 1fr;
        }
        
        .checkbox-grid {
            grid-template-columns: 1fr;
        }
        
        .save-button {
            bottom: 10px;
            right: 10px;
            left: 10px;
            width: auto;
        }
        
        /* Header responsivo */
        .header-user-info {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .header-photo {
            width: 70px;
            height: 70px;
        }
        
        .header-badges {
            position: absolute;
            top: -3px;
            right: -3px;
            flex-direction: row;
            gap: 3px;
        }
        
        .badge-vip, .badge-verified {
            padding: 3px 6px;
            font-size: 0.6rem;
        }
        
        .header-user-name {
            font-size: 1.5rem;
        }
        
        .header-user-type {
            font-size: 0.9rem;
        }
        
        .header-user-location {
            font-size: 0.8rem;
        }
        
        .edit-header {
            padding: 20px;
        }
        
        /* Barra de progresso responsiva */
        .progress-section {
            margin: 10px 15px 5px;
            padding: 12px;
        }
        
        .progress-message {
            font-size: 1rem;
        }
        
        /* Controles mobile otimizados */
        .mobile-tabs-control {
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .mobile-tab-btn {
            padding: 10px 15px;
            font-size: 0.9rem;
        }
    }
    
    @media (max-width: 480px) {
        .header-photo {
            width: 60px;
            height: 60px;
        }
        
        .header-user-name {
            font-size: 1.3rem;
        }
        
        .header-user-type {
            font-size: 0.85rem;
        }
        
        .header-user-location {
            font-size: 0.75rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container edit-container">
    <!-- Header removido temporariamente -->

    <!-- Formulário Principal -->
    <form method="post" enctype="multipart/form-data" id="profile-edit-form">
        {% csrf_token %}
        
        <!-- Navegação das Abas - FIXA -->
        <div class="tabs-nav-container">
            <div class="tabs-nav">
                <button type="button" class="tab-button active" data-tab="geral">
                    <i class="bi bi-person me-2"></i>Geral
                </button>
                <button type="button" class="tab-button" data-tab="informacoes">
                    <i class="bi bi-info-circle me-2"></i>Informações
                </button>
                <button type="button" class="tab-button" data-tab="interesses">
                    <i class="bi bi-heart me-2"></i>Interesses
                </button>
                <button type="button" class="tab-button" data-tab="bio">
                    <i class="bi bi-chat-text me-2"></i>Sobre
                </button>
            </div>
        </div>

        <div class="tabs-container">

            <!-- Aba Geral -->
            <div id="tab-geral" class="tab-content active">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-person-badge section-icon"></i>
                        Informações Básicas
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Nome do Perfil</label>
                                {{ form_geral.username }}
                                {% if form_geral.username.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_geral.username.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Tipo de Perfil</label>
                                <select name="tipo_perfil" class="form-control" id="tipo-perfil-select">
                                    {% for value, label in form_geral.tipo_perfil.field.choices %}
                                        {% if value != '' %}
                                            <option value="{{ value }}" {% if form_geral.tipo_perfil.value == value %}selected{% endif %}>
                                                {{ label }}
                                            </option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Campos de relacionamento (aparecem apenas para casais) -->
                    <div id="relacionamento-section" class="couple-section">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Tipo de Relação</label>
                                    {{ form_geral.tipo_relacionamento }}
                                    {% if form_geral.tipo_relacionamento.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form_geral.tipo_relacionamento.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Tempo Juntos</label>
                                    {{ form_geral.tempo_juntos }}
                                    {% if form_geral.tempo_juntos.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form_geral.tempo_juntos.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="form-label">Cidade/Estado</label>
                                <div class="autocomplete-container">
                                    <input type="text" 
                                           id="cidade-edit" 
                                           class="form-control" 
                                           name="cidade_estado" 
                                           value="{% if user.cidade_ref %}{{ user.cidade_ref.nome_completo }}{% elif user.cidade and user.estado %}{{ user.cidade }}, {{ user.estado }}{% endif %}"
                                           placeholder="Digite sua cidade (ex: Palotina, Paraná)"
                                           autocomplete="address-level2">
                                    <div id="suggestions-edit" class="suggestions-dropdown"></div>
                                </div>
                                <!-- Hidden fields para compatibilidade com o sistema existente -->
                                <input type="hidden" id="cidade_nome_edit" name="cidade" value="{% if user.cidade_ref %}{{ user.cidade_ref.nome }}{% else %}{{ user.cidade }}{% endif %}">
                                <input type="hidden" id="estado_edit" name="estado" value="{% if user.cidade_ref %}{{ user.cidade_ref.estado }}{% else %}{{ user.estado }}{% endif %}">
                                <input type="hidden" id="cidade_ref_edit" name="cidade_ref" value="{% if user.cidade_ref %}{{ user.cidade_ref.id }}{% endif %}">
                                <small class="form-text text-muted">Digite e selecione sua cidade da lista</small>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Informações Pessoais -->
            <div id="tab-informacoes" class="tab-content">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-person-circle section-icon"></i>
                        Informações Pessoais
                    </h3>
                    
                    <div style="background: red; color: white; padding: 20px; font-size: 24px; font-weight: bold;">
                        🚨 TESTE VISÍVEL - ABA INFORMAÇÕES FUNCIONANDO! 🚨
                    </div>
                    <p style="font-size: 18px; color: blue; font-weight: bold;">
                        Se você está vendo isso em VERMELHO, a aba está funcionando!
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Nome Completo</label>
                                <input type="text" name="nome_completo" class="form-control" placeholder="Digite seu nome">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Data de Nascimento</label>
                                <input type="date" name="data_nascimento" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Profissão</label>
                                <input type="text" name="profissao" class="form-control" placeholder="Sua profissão">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Cidade</label>
                                <input type="text" name="cidade" class="form-control" placeholder="Sua cidade">
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Controle de Abas para Casais -->
                    <div id="couple-tabs-control" class="couple-section">
                        <div class="mobile-tabs-control">
                            <button type="button" class="mobile-tab-btn active" data-person="ele">
                                <i class="bi bi-person me-2"></i>Ele
                            </button>
                            <button type="button" class="mobile-tab-btn" data-person="ela">
                                <i class="bi bi-person-dress me-2"></i>Ela
                            </button>
                        </div>
                    </div>
                    
                    <!-- Painel para Ele -->
                    <div id="painel-ele" class="person-panel active">
                        <!-- 1. Dados Pessoais -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-person-badge me-2"></i>Dados Pessoais - Ele <small class="text-muted">(0/9 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Nome / Apelido Público</label>
                                        <input type="text" name="nome_apelido_principal" class="form-control" 
                                               placeholder="Nome ou apelido público">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Data de Nascimento</label>
                                        <input type="date" name="data_nascimento_principal" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Signo</label>
                                        <select name="signo_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for signo in signos %}
                                                <option value="{{ signo.id }}">{{ signo.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Altura (cm)</label>
                                        <input type="number" name="altura_principal" class="form-control" 
                                               placeholder="Ex: 175" min="100" max="250">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Peso (kg)</label>
                                        <input type="number" name="peso_principal" class="form-control" 
                                               placeholder="Ex: 70" min="30" max="300">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Cor dos Olhos</label>
                                        <select name="cor_olhos_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cor in cores_olhos %}
                                                <option value="{{ cor.id }}">{{ cor.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Cor dos Cabelos</label>
                                        <select name="cor_cabelos_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cor in cores_cabelos %}
                                                <option value="{{ cor.id }}">{{ cor.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Profissão / Ocupação</label>
                                        <input type="text" name="profissao_principal" class="form-control" 
                                               placeholder="Sua profissão ou ocupação">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Origem (onde nasceu)</label>
                                        <select name="origem_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cidade in cidades %}
                                                <option value="{{ cidade.id }}">{{ cidade.nome_completo }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- 2. Estilo de Vida -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-heart me-2"></i>Estilo de Vida <small class="text-muted">(0/5 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Fumante</label>
                                        <select name="fumante_principal" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="ocasionalmente">Ocasionalmente</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Bebe</label>
                                        <select name="bebe_principal" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="socialmente">Socialmente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Pratica Esportes</label>
                                        <select name="esportes_principal" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="as_vezes">Às vezes</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Tem Filhos?</label>
                                        <select name="filhos_principal" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="adultos">Adultos</option>
                                            <option value="mora_com_filhos">Mora com filhos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label">Possui Tatuagens ou Piercings?</label>
                                        <select name="tatuagens_principal" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="varios">Vários</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- 3. Identidade e Preferências -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-rainbow me-2"></i>Identidade e Preferências <small class="text-muted">(0/3 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Gênero</label>
                                        <select name="genero_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="homem">Homem</option>
                                            <option value="mulher">Mulher</option>
                                            <option value="trans">Trans</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Orientação Sexual</label>
                                        <select name="orientacao_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="hetero">Hetero</option>
                                            <option value="homo">Homo</option>
                                            <option value="bi">Bi</option>
                                            <option value="pan">Pan</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label">Aberto a novos contatos com</label>
                                        <select name="contatos_principal" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="homens">Homens</option>
                                            <option value="mulheres">Mulheres</option>
                                            <option value="casais">Casais</option>
                                            <option value="todos">Todos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <!-- Painel para Ela -->
                    <div id="painel-ela" class="person-panel">
                        <!-- 1. Dados Pessoais -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-person-badge me-2"></i>Dados Pessoais - Ela <small class="text-muted">(0/9 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Nome / Apelido Público</label>
                                        <input type="text" name="nome_apelido_parceiro" class="form-control" 
                                               placeholder="Nome ou apelido público">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Data de Nascimento</label>
                                        <input type="date" name="data_nascimento_parceiro" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Signo</label>
                                        <select name="signo_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for signo in signos %}
                                                <option value="{{ signo.id }}">{{ signo.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Altura (cm)</label>
                                        <input type="number" name="altura_parceiro" class="form-control" 
                                               placeholder="Ex: 175" min="100" max="250">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Peso (kg)</label>
                                        <input type="number" name="peso_parceiro" class="form-control" 
                                               placeholder="Ex: 70" min="30" max="300">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Cor dos Olhos</label>
                                        <select name="cor_olhos_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cor in cores_olhos %}
                                                <option value="{{ cor.id }}">{{ cor.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Cor dos Cabelos</label>
                                        <select name="cor_cabelos_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cor in cores_cabelos %}
                                                <option value="{{ cor.id }}">{{ cor.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Profissão / Ocupação</label>
                                        <input type="text" name="profissao_parceiro" class="form-control" 
                                               placeholder="Profissão ou ocupação">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Origem (onde nasceu)</label>
                                        <select name="origem_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            {% for cidade in cidades %}
                                                <option value="{{ cidade.id }}">{{ cidade.nome_completo }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- 2. Estilo de Vida -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-heart me-2"></i>Estilo de Vida <small class="text-muted">(0/5 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Fumante</label>
                                        <select name="fumante_parceiro" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="ocasionalmente">Ocasionalmente</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Bebe</label>
                                        <select name="bebe_parceiro" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="socialmente">Socialmente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Pratica Esportes</label>
                                        <select name="esportes_parceiro" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="as_vezes">Às vezes</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Tem Filhos?</label>
                                        <select name="filhos_parceiro" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="adultos">Adultos</option>
                                            <option value="mora_com_filhos">Mora com filhos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label">Possui Tatuagens ou Piercings?</label>
                                        <select name="tatuagens_parceiro" class="form-control">
                                            <option value="nao">Não</option>
                                            <option value="sim">Sim</option>
                                            <option value="varios">Vários</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- 3. Identidade e Preferências -->
                        <div class="info-section">
                            <h4 class="subsection-title" onclick="toggleSection(this)">
                                <span><i class="bi bi-rainbow me-2"></i>Identidade e Preferências <small class="text-muted">(0/3 preenchidos)</small></span>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            </h4>
                            <div class="subsection-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Gênero</label>
                                        <select name="genero_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="homem">Homem</option>
                                            <option value="mulher">Mulher</option>
                                            <option value="trans">Trans</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Orientação Sexual</label>
                                        <select name="orientacao_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="hetero">Hetero</option>
                                            <option value="homo">Homo</option>
                                            <option value="bi">Bi</option>
                                            <option value="pan">Pan</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label">Aberto a novos contatos com</label>
                                        <select name="contatos_parceiro" class="form-control">
                                            <option value="">Selecione</option>
                                            <option value="homens">Homens</option>
                                            <option value="mulheres">Mulheres</option>
                                            <option value="casais">Casais</option>
                                            <option value="todos">Todos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Configurações de Privacidade -->
                    <div class="info-section mb-4">
                        <h4 class="subsection-title" onclick="toggleSection(this)">
                            <span><i class="bi bi-shield-lock me-2"></i>Privacidade e Controle <small class="text-muted">(0/3 preenchidos)</small></span>
                            <i class="bi bi-chevron-down collapse-icon"></i>
                        </h4>
                        <div class="subsection-content">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input type="checkbox" name="mostrar_idade" class="form-check-input" id="mostrar_idade">
                                    <label class="form-check-label" for="mostrar_idade">
                                        Mostrar idade
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input type="checkbox" name="mostrar_cidade" class="form-check-input" id="mostrar_cidade">
                                    <label class="form-check-label" for="mostrar_cidade">
                                        Mostrar cidade
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Disponível para mensagens</label>
                                    <select name="disponivel_mensagens" class="form-control">
                                        <option value="todos">Todos</option>
                                        <option value="vips">Somente VIPs</option>
                                        <option value="seguidores">Seguidores</option>
                                    </select>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Interesses -->
            <div id="tab-interesses" class="tab-content">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-heart-pulse section-icon"></i>
                        Interesses e Preferências
                    </h3>
                    
                    <!-- Campos para casal - Versão Mobile Otimizada (mantida para compatibilidade) -->
                    <div id="couple-info-section" class="couple-section">
                        <!-- Controle de Abas Mobile -->
                        <div class="mobile-tabs-control">
                            <button type="button" class="mobile-tab-btn active" data-person="ela">
                                <i class="bi bi-person-dress me-2"></i>Ela
                            </button>
                            <button type="button" class="mobile-tab-btn" data-person="ele">
                                <i class="bi bi-person me-2"></i>Ele
                            </button>
                        </div>
                        
                        <!-- Painel Ela (ativo por padrão) -->
                        <div id="painel-ela" class="person-panel active">
                            <div class="form-group">
                                <label class="form-label">Data Nascimento Dela</label>
                                <input type="date" 
                                       name="data_nascimento_parceiro" 
                                       id="id_data_nascimento_ela"
                                       class="form-control" 
                                       value="{% if user.data_nascimento_parceiro %}{{ user.data_nascimento_parceiro|date:'Y-m-d' }}{% else %}{{ '' }}{% endif %}"
                                       autocomplete="bday">
                                {% if form_informacoes.data_nascimento_parceiro.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.data_nascimento_parceiro.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label class="form-label">Profissão Dela</label>
                                {{ form_informacoes.profissao_parceiro }}
                                {% if form_informacoes.profissao_parceiro.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.profissao_parceiro.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label class="form-label">Orientação Sexual Dela</label>
                                {{ form_informacoes.orientacao_sexual_parceiro }}
                                {% if form_informacoes.orientacao_sexual_parceiro.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.orientacao_sexual_parceiro.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            </div>
                        </div>
                        
                        <!-- Painel Ele -->
                        <div id="painel-ele" class="person-panel">
                            <div class="form-group">
                                <label class="form-label">Data Nascimento Dele</label>
                                <input type="date" 
                                       name="data_nascimento" 
                                       id="id_data_nascimento_ele"
                                       class="form-control" 
                                       value="{% if user.data_nascimento %}{{ user.data_nascimento|date:'Y-m-d' }}{% else %}{{ '' }}{% endif %}"
                                       autocomplete="bday">
                                {% if form_informacoes.data_nascimento.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.data_nascimento.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label class="form-label">Profissão Dele</label>
                                {{ form_informacoes.profissao }}
                                {% if form_informacoes.profissao.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.profissao.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label class="form-label">Orientação Sexual Dele</label>
                                {{ form_informacoes.orientacao_sexual }}
                                {% if form_informacoes.orientacao_sexual.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form_informacoes.orientacao_sexual.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Aba Interesses -->
            <div id="tab-interesses" class="tab-content">
                <div class="interests-grid">
                    <div class="interest-category">
                        <h4 class="category-title">
                            <i class="bi bi-search category-icon"></i>
                            Procurando por
                        </h4>
                        <div class="checkbox-grid">
                            {% for checkbox in form_interesses.interesses %}
                                <div class="form-check">
                                    {{ checkbox.tag }}
                                    <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                                        {{ checkbox.choice_label }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="interest-category">
                        <h4 class="category-title">
                            <i class="bi bi-target category-icon"></i>
                            Objetivos
                        </h4>
                        <div class="checkbox-grid">
                            {% for checkbox in form_interesses.objetivos %}
                                <div class="form-check">
                                    {{ checkbox.tag }}
                                    <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                                        {{ checkbox.choice_label }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="interest-category">
                        <h4 class="category-title">
                            <i class="bi bi-heart category-icon"></i>
                            Fetiches e Preferências
                        </h4>
                        <div class="checkbox-grid">
                            {% for checkbox in form_interesses.fetiches %}
                                <div class="form-check">
                                    {{ checkbox.tag }}
                                    <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                                        {{ checkbox.choice_label }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Sobre (Bio) -->
            <div id="tab-bio" class="tab-content">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-chat-text section-icon"></i>
                        Conte sobre você
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Biografia</label>
                        {{ form_bio.bio }}
                        <div class="bio-counter" id="bio-counter">
                            <span id="char-count">0</span>/1000 caracteres
                        </div>
                        {% if form_bio.bio.errors %}
                            <div class="text-danger small mt-1">
                                {% for error in form_bio.bio.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="alert alert-info">
                        <i class="bi bi-lightbulb me-2"></i>
                        <strong>Dica:</strong> Seja criativo! Conte sobre seus hobbies, interesses, o que você gosta de fazer nos finais de semana, ou qualquer coisa que te torne único. Isso ajuda outros usuários a te conhecerem melhor!
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Botão de Salvar -->
    <button type="button" class="save-button" id="save-button" onclick="saveProfile()">
        <i class="bi bi-check-lg me-2"></i>Salvar Alterações
    </button>
</div>

<script>
// Sistema de Abas - VERSÃO ULTRA SIMPLES QUE FUNCIONA
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== INICIANDO SISTEMA DE ABAS ===');
    
    // Função para mostrar aba - VERSÃO QUE FUNCIONA
    function mostrarAba(nomeAba) {
        console.log('=== MOSTRANDO ABA:', nomeAba, '===');
        
        // Esconder TODAS as abas
        document.querySelectorAll('.tab-content').forEach(aba => {
            aba.style.display = 'none';
            aba.classList.remove('active');
        });
        
        // Remover active de TODOS os botões
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Mostrar aba selecionada
        const aba = document.getElementById('tab-' + nomeAba);
        console.log('Aba encontrada:', aba);
        
        if (aba) {
            aba.style.display = 'block';
            aba.classList.add('active');
            console.log('✅ ABA EXIBIDA COM SUCESSO!');
        } else {
            console.error('❌ Aba não encontrada: tab-' + nomeAba);
        }
        
        // Ativar botão
        const botao = document.querySelector('[data-tab="' + nomeAba + '"]');
        if (botao) {
            botao.classList.add('active');
            console.log('✅ Botão ativado');
        }
        
        console.log('=== FIM MOSTRAR ABA ===');
    }
    
    // Adicionar eventos aos botões
    document.querySelectorAll('.tab-button').forEach(botao => {
        botao.addEventListener('click', function() {
            const aba = this.getAttribute('data-tab');
            console.log('Clique na aba:', aba);
            mostrarAba(aba);
        });
    });
    
    // Mostrar primeira aba por padrão
    mostrarAba('geral');
    console.log('=== SISTEMA INICIADO ===');
});

// Adaptação para Modo Casal
document.getElementById('tipo-perfil-select').addEventListener('change', function() {
    const tipoPerfil = this.value;
    
    // Controle da aba Geral - Campos de relacionamento
    const relacionamentoSection = document.getElementById('relacionamento-section');
    
    // Controle da aba Informações - Novas abas
    const coupleTabsControl = document.getElementById('couple-tabs-control');
    const painelEle = document.getElementById('painel-ele');
    const painelEla = document.getElementById('painel-ela');
    
    if (tipoPerfil && tipoPerfil.indexOf('casal_') === 0) {
        // Mostrar campos de relacionamento para casais
        if (relacionamentoSection) {
            relacionamentoSection.classList.add('active');
            relacionamentoSection.style.display = 'block';
        }
        
        // Mostrar abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.classList.add('active');
            coupleTabsControl.style.display = 'block';
        }
        if (painelEle) {
            painelEle.classList.add('active');
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
        
    } else {
        // Esconder campos de relacionamento para individuais
        if (relacionamentoSection) {
            relacionamentoSection.classList.remove('active');
            relacionamentoSection.style.display = 'none';
        }
        
        // Esconder abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.classList.remove('active');
            coupleTabsControl.style.display = 'none';
        }
        if (painelEle) {
            painelEle.classList.add('active');
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
        
    }
});

// Controle das Abas Mobile (Ele/Ela)
document.addEventListener('DOMContentLoaded', function() {
    const mobileTabBtns = document.querySelectorAll('.mobile-tab-btn');
    
    console.log('Abas encontradas:', mobileTabBtns.length);
    
    mobileTabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const person = this.getAttribute('data-person');
            console.log('Clicou na aba:', person);
            
            // Remover active de todos os botões
            mobileTabBtns.forEach(b => b.classList.remove('active'));
            
            // Adicionar active ao botão clicado
            this.classList.add('active');
            
            // Esconder todos os painéis
            document.querySelectorAll('.person-panel').forEach(panel => {
                panel.classList.remove('active');
                panel.style.display = 'none';
            });
            
            // Mostrar painel correspondente
            const targetPanel = document.getElementById(`painel-${person}`);
            console.log('Painel encontrado:', targetPanel);
            if (targetPanel) {
                targetPanel.classList.add('active');
                targetPanel.style.display = 'block';
            }
        });
    });
    
    // Inicializar seções colapsáveis no mobile
    if (window.innerWidth <= 768) {
        const sections = document.querySelectorAll('.subsection-title');
        sections.forEach(section => {
            const content = section.nextElementSibling;
            if (content && content.classList.contains('subsection-content')) {
                section.classList.add('collapsed');
                content.classList.add('collapsed');
            }
        });
    }
    
    // Inicializar abas Ele/Ela
    initializeTabs();
});

// Função para inicializar as abas
function initializeTabs() {
    const tipoPerfil = document.getElementById('tipo-perfil-select').value;
    const coupleTabsControl = document.getElementById('couple-tabs-control');
    const painelEle = document.getElementById('painel-ele');
    const painelEla = document.getElementById('painel-ela');
    
    console.log('Tipo de perfil:', tipoPerfil);
    console.log('Controle de abas:', coupleTabsControl);
    console.log('Painel Ele:', painelEle);
    console.log('Painel Ela:', painelEla);
    
    if (tipoPerfil && tipoPerfil.indexOf('casal_') === 0) {
        // Mostrar abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.style.display = 'block';
        }
        if (painelEle) {
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
    } else {
        // Esconder abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.style.display = 'none';
        }
        if (painelEle) {
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
    }
}

// Função para controlar seções colapsáveis
function toggleSection(titleElement) {
    const content = titleElement.nextElementSibling;
    if (content && content.classList.contains('subsection-content')) {
        titleElement.classList.toggle('collapsed');
        content.classList.toggle('collapsed');
    }
}

// Contador de caracteres para bio
document.getElementById('bio-textarea').addEventListener('input', function() {
    const charCount = this.value.length;
    const counter = document.getElementById('char-count');
    const counterDiv = document.getElementById('bio-counter');
    
    counter.textContent = charCount;
    
    // Mudar cor conforme limite
    counterDiv.className = 'bio-counter';
    if (charCount > 800) {
        counterDiv.classList.add('warning');
    }
    if (charCount > 950) {
        counterDiv.classList.add('danger');
    }
});

// Salvar Perfil
function saveProfile() {
    const saveButton = document.getElementById('save-button');
    const form = document.getElementById('profile-edit-form');
    
    saveButton.disabled = true;
    saveButton.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Salvando...';
    
    // Simular salvamento (substituir por AJAX real)
    setTimeout(() => {
        form.submit();
    }, 1000);
}

// Inicializar largura da barra de progresso
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.querySelector('.progress-bar-fill');
    if (progressBar) {
        const width = progressBar.getAttribute('data-width');
        if (width) {
            progressBar.style.width = width + '%';
        }
    }
});

// Inicializar estado do modo casal
document.addEventListener('DOMContentLoaded', function() {
    const tipoPerfil = document.getElementById('tipo-perfil-select').value;
    
    // Controle da aba Geral - Campos de relacionamento
    const relacionamentoSection = document.getElementById('relacionamento-section');
    
    // Controle da aba Informações
    const coupleInfoSection = document.getElementById('couple-info-section');
    const individualInfoSection = document.getElementById('individual-info-section');
    
    if (tipoPerfil && tipoPerfil.indexOf('casal_') === 0) {
        // Mostrar campos de relacionamento para casais
        if (relacionamentoSection) {
            relacionamentoSection.classList.add('active');
            relacionamentoSection.style.display = 'block';
        }
        
        // Mostrar abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.classList.add('active');
            coupleTabsControl.style.display = 'block';
        }
        if (painelEle) {
            painelEle.classList.add('active');
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
        
    } else {
        // Esconder campos de relacionamento para individuais
        if (relacionamentoSection) {
            relacionamentoSection.classList.remove('active');
            relacionamentoSection.style.display = 'none';
        }
        
        // Esconder abas de casal
        if (coupleTabsControl) {
            coupleTabsControl.classList.remove('active');
            coupleTabsControl.style.display = 'none';
        }
        if (painelEle) {
            painelEle.classList.add('active');
            painelEle.style.display = 'block';
        }
        if (painelEla) {
            painelEla.style.display = 'none';
        }
        
    }
    
    // Inicializar contador de caracteres
    const bioTextarea = document.getElementById('bio-textarea');
    if (bioTextarea) {
        const charCount = bioTextarea.value.length;
        document.getElementById('char-count').textContent = charCount;
        
        if (charCount > 800) {
            document.getElementById('bio-counter').classList.add('warning');
        }
        if (charCount > 950) {
            document.getElementById('bio-counter').classList.add('danger');
        }
    }
});

// Autocomplete para cidades
document.addEventListener('DOMContentLoaded', function() {
    const cidadeInput = document.getElementById('cidade-edit');
    const suggestionsDiv = document.getElementById('suggestions-edit');
    
    if (!cidadeInput || !suggestionsDiv) {
        console.log('Elementos não encontrados');
        return;
    }
    
    // Lista de cidades brasileiras
    let cidades = [
        // Paraná
        { id: 1, nome: 'Palotina', estado: 'PR', nome_completo: 'Palotina, PR' },
        { id: 2, nome: 'Curitiba', estado: 'PR', nome_completo: 'Curitiba, PR' },
        { id: 3, nome: 'Londrina', estado: 'PR', nome_completo: 'Londrina, PR' },
        { id: 4, nome: 'Maringá', estado: 'PR', nome_completo: 'Maringá, PR' },
        { id: 5, nome: 'Ponta Grossa', estado: 'PR', nome_completo: 'Ponta Grossa, PR' },
        { id: 6, nome: 'Cascavel', estado: 'PR', nome_completo: 'Cascavel, PR' },
        { id: 7, nome: 'Toledo', estado: 'PR', nome_completo: 'Toledo, PR' },
        { id: 8, nome: 'Foz do Iguaçu', estado: 'PR', nome_completo: 'Foz do Iguaçu, PR' },
        { id: 9, nome: 'Guarapuava', estado: 'PR', nome_completo: 'Guarapuava, PR' },
        { id: 10, nome: 'Paranaguá', estado: 'PR', nome_completo: 'Paranaguá, PR' },
        
        // São Paulo
        { id: 11, nome: 'São Paulo', estado: 'SP', nome_completo: 'São Paulo, SP' },
        { id: 12, nome: 'Campinas', estado: 'SP', nome_completo: 'Campinas, SP' },
        { id: 13, nome: 'Santos', estado: 'SP', nome_completo: 'Santos, SP' },
        { id: 14, nome: 'Ribeirão Preto', estado: 'SP', nome_completo: 'Ribeirão Preto, SP' },
        { id: 15, nome: 'Sorocaba', estado: 'SP', nome_completo: 'Sorocaba, SP' },
        { id: 16, nome: 'São José dos Campos', estado: 'SP', nome_completo: 'São José dos Campos, SP' },
        { id: 17, nome: 'Guarulhos', estado: 'SP', nome_completo: 'Guarulhos, SP' },
        { id: 18, nome: 'Santo André', estado: 'SP', nome_completo: 'Santo André, SP' },
        
        // Rio de Janeiro
        { id: 19, nome: 'Rio de Janeiro', estado: 'RJ', nome_completo: 'Rio de Janeiro, RJ' },
        { id: 20, nome: 'Niterói', estado: 'RJ', nome_completo: 'Niterói, RJ' },
        { id: 21, nome: 'Nova Iguaçu', estado: 'RJ', nome_completo: 'Nova Iguaçu, RJ' },
        { id: 22, nome: 'Duque de Caxias', estado: 'RJ', nome_completo: 'Duque de Caxias, RJ' },
        { id: 23, nome: 'São Gonçalo', estado: 'RJ', nome_completo: 'São Gonçalo, RJ' },
        
        // Minas Gerais
        { id: 24, nome: 'Belo Horizonte', estado: 'MG', nome_completo: 'Belo Horizonte, MG' },
        { id: 25, nome: 'Uberlândia', estado: 'MG', nome_completo: 'Uberlândia, MG' },
        { id: 26, nome: 'Contagem', estado: 'MG', nome_completo: 'Contagem, MG' },
        { id: 27, nome: 'Juiz de Fora', estado: 'MG', nome_completo: 'Juiz de Fora, MG' },
        
        // Bahia
        { id: 28, nome: 'Salvador', estado: 'BA', nome_completo: 'Salvador, BA' },
        { id: 29, nome: 'Feira de Santana', estado: 'BA', nome_completo: 'Feira de Santana, BA' },
        { id: 30, nome: 'Vitória da Conquista', estado: 'BA', nome_completo: 'Vitória da Conquista, BA' },
        
        // Rio Grande do Sul
        { id: 31, nome: 'Porto Alegre', estado: 'RS', nome_completo: 'Porto Alegre, RS' },
        { id: 32, nome: 'Caxias do Sul', estado: 'RS', nome_completo: 'Caxias do Sul, RS' },
        { id: 33, nome: 'Pelotas', estado: 'RS', nome_completo: 'Pelotas, RS' },
        
        // Pernambuco
        { id: 34, nome: 'Recife', estado: 'PE', nome_completo: 'Recife, PE' },
        { id: 35, nome: 'Jaboatão dos Guararapes', estado: 'PE', nome_completo: 'Jaboatão dos Guararapes, PE' },
        { id: 36, nome: 'Olinda', estado: 'PE', nome_completo: 'Olinda, PE' },
        
        // Ceará
        { id: 37, nome: 'Fortaleza', estado: 'CE', nome_completo: 'Fortaleza, CE' },
        { id: 38, nome: 'Caucaia', estado: 'CE', nome_completo: 'Caucaia, CE' },
        { id: 39, nome: 'Juazeiro do Norte', estado: 'CE', nome_completo: 'Juazeiro do Norte, CE' },
        
        // Pará
        { id: 40, nome: 'Belém', estado: 'PA', nome_completo: 'Belém, PA' },
        { id: 41, nome: 'Ananindeua', estado: 'PA', nome_completo: 'Ananindeua, PA' },
        { id: 42, nome: 'Santarém', estado: 'PA', nome_completo: 'Santarém, PA' }
    ];
    
    // Tentar carregar da API (opcional)
    fetch('/usuarios/api/cidades/')
        .then(response => response.json())
        .then(data => {
            if (data && data.length > 0) {
                cidades = data;
                console.log('Cidades carregadas da API:', cidades.length);
            }
        })
        .catch(error => {
            console.log('Usando lista local de cidades:', cidades.length);
        });
    
    let selectedCity = null;
    
    function showSuggestions(cities) {
        suggestionsDiv.innerHTML = '';
        
        if (cities.length === 0) {
            suggestionsDiv.style.display = 'none';
            return;
        }
        
        cities.forEach(city => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.innerHTML = `
                <span class="suggestion-city">${city.nome}</span>
                <span class="suggestion-state">${city.estado}</span>
            `;
            
            item.addEventListener('click', function() {
                selectCity(city);
            });
            
            suggestionsDiv.appendChild(item);
        });
        
        suggestionsDiv.style.display = 'block';
    }
    
    function selectCity(city) {
        selectedCity = city;
        cidadeInput.value = city.nome_completo;
        
        // Preencher campos hidden
        document.getElementById('cidade_nome_edit').value = city.nome;
        document.getElementById('estado_edit').value = city.estado;
        document.getElementById('cidade_ref_edit').value = city.id;
        
        suggestionsDiv.style.display = 'none';
    }
    
    function searchCities(query) {
        if (query.length < 2) {
            suggestionsDiv.style.display = 'none';
            selectedCity = null;
            return;
        }
        
        const queryLower = query.toLowerCase();
        const filtered = cidades.filter(city => 
            city.nome.toLowerCase().includes(queryLower) ||
            city.estado.toLowerCase().includes(queryLower) ||
            city.nome_completo.toLowerCase().includes(queryLower)
        );
        
        // Limitar a 10 resultados para melhor performance
        showSuggestions(filtered.slice(0, 10));
    }
    
    // Event listeners
    cidadeInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        // Reset selection if user types something different
        if (selectedCity && !this.value.includes(selectedCity.nome)) {
            selectedCity = null;
            // Limpar campos hidden
            document.getElementById('cidade_nome_edit').value = '';
            document.getElementById('estado_edit').value = '';
            document.getElementById('cidade_ref_edit').value = '';
        }
        
        searchCities(query);
    });
    
    cidadeInput.addEventListener('focus', function() {
        if (this.value.trim().length >= 2) {
            searchCities(this.value.trim());
        }
    });
    
    // Hide suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (!cidadeInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
            suggestionsDiv.style.display = 'none';
        }
    });
});
</script>
{% endblock %}