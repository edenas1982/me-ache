{% extends 'base/base.html' %}
{% load static %}

{% block title %}Editar Perfil - Me Ache{% endblock %}

{% block extra_css %}
<style>
    /* RESET SIMPLES E DIRETO */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    /* Vari√°veis CSS para consist√™ncia */
    :root {
        --cor-principal: #e91e63;
        --cor-principal-hover: #c2185b;
        --cor-principal-light: #fce4ec;
        --cor-secundaria: #757575;
        --cor-texto: #333333;
        --cor-texto-light: #666666;
        --cor-borda: #e0e0e0;
        --cor-fundo: #f8f9fa;
        --cor-branco: #ffffff;
        --borda-radius: 8px;
        --sombra-suave: 0 2px 8px rgba(0,0,0,0.1);
        --sombra-media: 0 4px 12px rgba(0,0,0,0.15);
        --transicao: all 0.3s ease;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--cor-fundo);
        line-height: 1.6;
        color: var(--cor-texto);
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* CABE√áALHO FIXO */
    .header-fixed {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: var(--cor-branco);
        box-shadow: var(--sombra-suave);
        z-index: 1000;
        padding: 10px 0;
        transition: var(--transicao);
    }
    
    .tabs {
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    
    .tab-btn {
        padding: 12px 24px;
        background: var(--cor-borda);
        border: none;
        border-radius: var(--borda-radius);
        cursor: pointer;
        font-weight: 600;
        transition: var(--transicao);
        color: var(--cor-texto);
    }
    
    .tab-btn:hover {
        background: var(--cor-principal-light);
        color: var(--cor-principal);
    }
    
    .tab-btn.active {
        background: var(--cor-principal);
        color: var(--cor-branco);
        box-shadow: var(--sombra-suave);
    }
    
    /* CONTE√öDO */
    .content {
        margin-top: 80px; /* Espa√ßo para header fixo */
        background: var(--cor-branco);
        border-radius: var(--borda-radius);
        padding: 30px;
        box-shadow: var(--sombra-suave);
        margin-bottom: 100px; /* Espa√ßo para bot√£o fixo */
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* FORMUL√ÅRIO */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--cor-texto);
        font-size: 14px;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--cor-borda);
        border-radius: var(--borda-radius);
        font-size: 14px;
        transition: var(--transicao);
        background: var(--cor-branco);
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--cor-principal);
        box-shadow: 0 0 0 3px var(--cor-principal-light);
    }
        font-size: 16px;
    }
    
    .row {
        display: flex;
        gap: 15px;
    }
    
    .col-6 {
        flex: 1;
    }
    
    /* BOT√ÉO SALVAR */
    .save-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--cor-principal);
        color: var(--cor-branco);
        border: none;
        padding: 16px 32px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: var(--sombra-media);
        transition: var(--transicao);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .save-btn:hover {
        background: var(--cor-principal-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(233, 30, 99, 0.3);
    }
    
    .save-btn:active {
        transform: translateY(0);
    }
    }
    
    /* Autocomplete para cidade */
    .autocomplete-container {
        position: relative;
    }
    
    .suggestions-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 5px 5px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .suggestion-item {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .suggestion-item:hover {
        background-color: #f5f5f5;
    }
    
    .suggestion-item:last-child {
        border-bottom: none;
    }
    
    .suggestion-city {
        font-weight: 500;
        color: #333;
    }
    
    .suggestion-state {
        font-size: 12px;
        color: #666;
        background: #e91e63;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-weight: 600;
    }
    
    /* Se√ß√£o de relacionamento */
    .relacionamento-section {
        margin-top: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
    }
    
    /* Abas internas para casais */
    .couple-tabs-control {
        margin: 20px 0;
    }
    
    .internal-tabs {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
    }
    
    .internal-tab-btn {
        padding: 12px 24px;
        background: #f0f0f0;
        border: 2px solid #ddd;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .internal-tab-btn.active {
        background: #e91e63;
        color: white;
        border-color: #e91e63;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
    }
    
    .internal-tab-btn:hover:not(.active) {
        background: #e0e0e0;
        border-color: #e91e63;
        color: #e91e63;
    }
    
    /* Pain√©is de pessoa */
    .person-panel {
        display: none;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #e0e0e0;
        margin-bottom: 20px;
    }
    
    .person-panel.active {
        display: block;
    }
    
    .person-panel h3 {
        color: #e91e63;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e91e63;
        font-size: 20px;
    }
    
    /* Se√ß√µes de interesse */
    .interest-section {
        margin-bottom: 30px;
        padding: 24px;
        background: var(--cor-fundo);
        border-radius: var(--borda-radius);
        border: 1px solid var(--cor-borda);
        box-shadow: var(--sombra-suave);
        transition: var(--transicao);
    }
    
    .interest-section:hover {
        box-shadow: var(--sombra-media);
    }
    
    .interest-section h3 {
        color: var(--cor-principal);
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .interest-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
    }
    
    .interest-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        background: var(--cor-branco);
        border: 2px solid var(--cor-borda);
        border-radius: var(--borda-radius);
        cursor: pointer;
        transition: var(--transicao);
    }
    
    .interest-item:hover {
        border-color: var(--cor-principal);
        background: var(--cor-principal-light);
        transform: translateY(-1px);
    }
    
    .interest-item:has(input:checked) {
        border-color: var(--cor-principal);
        background: var(--cor-principal-light);
        color: var(--cor-principal);
    }
    
    .interest-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    
    .interest-label {
        font-weight: 500;
        color: #333;
    }
    
    .radio-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
    }
    
    .radio-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .radio-item:hover {
        border-color: #e91e63;
        background: #fef7f7;
    }
    
    .radio-item input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    
    .radio-label {
        font-weight: 500;
        color: #333;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #fff3cd;
        border: 2px solid #ffeaa7;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .checkbox-item:hover {
        background: #fff8e1;
        border-color: #e91e63;
    }
    
    .checkbox-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    
    .checkbox-label {
        font-weight: 600;
        color: #333;
    }
    
    /* Se√ß√µes sobre */
    .about-section {
        margin-bottom: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 1px solid #e0e0e0;
    }
    
    .about-section h3 {
        color: #e91e63;
        margin-bottom: 15px;
        font-size: 18px;
    }
    
    .form-text {
        color: #666;
        font-size: 12px;
        margin-top: 5px;
    }
    
    /* Mini Cabe√ßalho - Aba Geral */
    .mini-header {
        background: linear-gradient(135deg, var(--cor-principal), var(--cor-principal-hover));
        color: var(--cor-branco);
        padding: 30px;
        border-radius: var(--borda-radius);
        margin-bottom: 30px;
        box-shadow: var(--sombra-media);
        position: relative;
        overflow: hidden;
    }
    
    .mini-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }
    
    .mini-header-content {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .avatar-section {
        position: relative;
    }
    
    .avatar-container {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 4px solid var(--cor-branco);
        overflow: hidden;
        box-shadow: var(--sombra-suave);
        position: relative;
        cursor: pointer;
        transition: var(--transicao);
    }
    
    .avatar-container:hover {
        transform: scale(1.05);
        box-shadow: var(--sombra-media);
    }
    
    .avatar-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: var(--cor-principal-light);
    }
    
    .avatar-placeholder {
        width: 100%;
        height: 100%;
        background: var(--cor-principal-light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        color: var(--cor-principal);
    }
    
    .avatar-upload {
        position: absolute;
        bottom: -5px;
        right: -5px;
        background: var(--cor-branco);
        border: 2px solid var(--cor-principal);
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transicao);
    }
    
    .avatar-upload:hover {
        background: var(--cor-principal);
        color: var(--cor-branco);
    }
    
    .profile-info {
        flex: 1;
    }
    
    .profile-name {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .profile-phrase {
        font-size: 16px;
        opacity: 0.9;
        font-weight: 400;
        line-height: 1.4;
    }
    
    .profile-stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-value {
        font-size: 18px;
        font-weight: 700;
        display: block;
    }
    
    .stat-label {
        font-size: 12px;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Responsividade para mobile */
    @media (max-width: 768px) {
        .mini-header {
            padding: 20px;
        }
        
        .mini-header-content {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .avatar-container {
            width: 60px;
            height: 60px;
        }
        
        .profile-name {
            font-size: 24px;
        }
        
        .profile-phrase {
            font-size: 14px;
        }
        
        .profile-stats {
            justify-content: center;
        }
    }
    
    @media (max-width: 768px) {
        .internal-tabs {
            flex-direction: column;
            gap: 5px;
        }
        
        .internal-tab-btn {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .person-panel {
            padding: 15px;
        }
        
        .person-panel h3 {
            font-size: 18px;
        }
        
        .row {
            margin: 0;
        }
        
        .col-6, .col-4 {
            padding: 0 5px;
            margin-bottom: 10px;
        }
        
        .interest-grid {
            grid-template-columns: 1fr;
        }
        
        .radio-group {
            grid-template-columns: 1fr;
        }
        
        .interest-section, .about-section {
            padding: 15px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Header Fixo -->
    <div class="header-fixed">
        <div class="tabs">
            <button class="tab-btn active" data-tab="geral">Geral</button>
            <button class="tab-btn" data-tab="informacoes">Informa√ß√µes</button>
            <button class="tab-btn" data-tab="interesses">Interesses</button>
            <button class="tab-btn" data-tab="sobre">Sobre</button>
        </div>
    </div>

    <!-- Conte√∫do -->
    <div class="content">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Aba Geral -->
            <div id="geral" class="tab-content active">
                <!-- Mini Cabe√ßalho -->
                <div class="mini-header">
                    <div class="mini-header-content">
                        <div class="avatar-section">
                            <div class="avatar-container" onclick="document.getElementById('avatar-upload').click()">
                                {% if user.foto_perfil %}
                                    <img src="{{ user.foto_perfil.url }}" alt="Avatar" class="avatar-image">
                                {% else %}
                                    <div class="avatar-placeholder">
                                        üë§
                                    </div>
                                {% endif %}
                                <div class="avatar-upload">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                </div>
                            </div>
                            <input type="file" id="avatar-upload" name="foto_perfil" accept="image/*" style="display: none;" onchange="previewAvatar(this)">
                        </div>
                        
                        <div class="profile-info">
                            <div class="profile-name">
                                <input type="text" 
                                       name="username" 
                                       value="{{ user.username }}" 
                                       class="form-control" 
                                       style="background: transparent; border: 2px solid rgba(255,255,255,0.3); color: white; font-size: 28px; font-weight: 700; text-align: left; padding: 8px 12px; border-radius: 8px;"
                                       placeholder="Nome do perfil">
                            </div>
                            <div class="profile-phrase">
                                <input type="text" 
                                       name="frase_curta" 
                                       value="{% if user.perfil_sobre %}{{ user.perfil_sobre.frase_destaque }}{% endif %}" 
                                       class="form-control" 
                                       style="background: transparent; border: 2px solid rgba(255,255,255,0.3); color: white; font-size: 16px; text-align: left; padding: 8px 12px; border-radius: 8px;"
                                       placeholder="Frase curta sobre voc√™s...">
                            </div>
                            
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span class="stat-value">{{ user.tipo_perfil|title }}</span>
                                    <span class="stat-label">Perfil</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">{% if user.cidade_ref %}{{ user.cidade_ref.nome }}{% else %}N/A{% endif %}</span>
                                    <span class="stat-label">Localiza√ß√£o</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">{% if user.tipo_relacionamento %}{{ user.tipo_relacionamento.nome }}{% else %}N/A{% endif %}</span>
                                    <span class="stat-label">Rela√ß√£o</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2>üìã Configura√ß√µes B√°sicas</h2>
                
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Tipo de Perfil</label>
                            <select name="tipo_perfil" class="form-control" id="tipo-perfil-select">
                                {% for value, label in user.PERFIL_CHOICES %}
                                    {% if value != '' %}
                                        <option value="{{ value }}" {% if user.tipo_perfil == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% else %}
                                        <optgroup label="{{ label }}"></optgroup>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Status do Perfil</label>
                            <select name="status_perfil" class="form-control">
                                <option value="ativo" {% if user.is_active %}selected{% endif %}>‚úÖ Ativo</option>
                                <option value="inativo" {% if not user.is_active %}selected{% endif %}>‚è∏Ô∏è Inativo</option>
                                <option value="privado">üîí Privado</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Campos de relacionamento (aparecem apenas para casais) -->
                <div id="relacionamento-section" class="relacionamento-section" style="display: none;">
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Tipo de Rela√ß√£o</label>
                                <select name="tipo_relacionamento" class="form-control">
                                    <option value="">Selecione</option>
                                    {% for rel in tipos_relacionamento %}
                                        <option value="{{ rel.id }}" {% if user.tipo_relacionamento_id == rel.id %}selected{% endif %}>
                                            {{ rel.nome }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Tempo Juntos</label>
                                <select name="tempo_juntos" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="menos_1_ano" {% if user.tempo_juntos == 'menos_1_ano' %}selected{% endif %}>Menos de 1 ano</option>
                                    <option value="1_2_anos" {% if user.tempo_juntos == '1_2_anos' %}selected{% endif %}>1-2 anos</option>
                                    <option value="3_5_anos" {% if user.tempo_juntos == '3_5_anos' %}selected{% endif %}>3-5 anos</option>
                                    <option value="6_10_anos" {% if user.tempo_juntos == '6_10_anos' %}selected{% endif %}>6-10 anos</option>
                                    <option value="mais_10_anos" {% if user.tempo_juntos == 'mais_10_anos' %}selected{% endif %}>Mais de 10 anos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìç Localiza√ß√£o</label>
                    <div class="autocomplete-container">
                        <input type="text" 
                               id="cidade-input" 
                               class="form-control" 
                               name="cidade_estado" 
                               value="{% if user.cidade_ref %}{{ user.cidade_ref.nome_completo }}{% elif user.cidade and user.estado %}{{ user.cidade }}, {{ user.estado }}{% endif %}"
                               placeholder="Digite sua cidade (ex: Palotina, Paran√°)"
                               autocomplete="off">
                        <div id="suggestions" class="suggestions-dropdown"></div>
                    </div>
                    <!-- Hidden fields para compatibilidade -->
                    <input type="hidden" id="cidade_nome" name="cidade" value="{% if user.cidade_ref %}{{ user.cidade_ref.nome }}{% else %}{{ user.cidade }}{% endif %}">
                    <input type="hidden" id="estado" name="estado" value="{% if user.cidade_ref %}{{ user.cidade_ref.estado }}{% else %}{{ user.estado }}{% endif %}">
                    <input type="hidden" id="cidade_ref" name="cidade_ref" value="{% if user.cidade_ref %}{{ user.cidade_ref.id }}{% endif %}">
                </div>
            </div>

            <!-- Aba Informa√ß√µes -->
            <div id="informacoes" class="tab-content">
                <h2>Informa√ß√µes Pessoais</h2>
                
                <!-- Controle de abas internas para casais -->
                <div id="couple-tabs-control" class="couple-tabs-control" style="display: none;">
                    <div class="internal-tabs">
                        <button type="button" class="internal-tab-btn active" data-person="ele">
                            üë® Ele
                        </button>
                        <button type="button" class="internal-tab-btn" data-person="ela">
                            üë© Ela
                        </button>
                    </div>
                </div>
                
                <!-- Painel para Ele -->
                <div id="painel-ele" class="person-panel active">
                    <h3>üë® Dados Pessoais - Ele</h3>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Nome / Apelido</label>
                                <input type="text" name="nome_ele" class="form-control" placeholder="Nome ou apelido p√∫blico">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Data de Nascimento</label>
                                <input type="date" name="data_nascimento_ele" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Profiss√£o</label>
                                <input type="text" name="profissao_ele" class="form-control" placeholder="Sua profiss√£o">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Orienta√ß√£o Sexual</label>
                                <select name="orientacao_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="heterossexual">Heterossexual</option>
                                    <option value="bissexual">Bissexual</option>
                                    <option value="homossexual">Homossexual</option>
                                    <option value="pansexual">Pansexual</option>
                                    <option value="assexual">Assexual</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Altura (cm)</label>
                                <input type="number" name="altura_ele" class="form-control" placeholder="Ex: 175" min="100" max="250">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Peso (kg)</label>
                                <input type="number" name="peso_ele" class="form-control" placeholder="Ex: 70" min="30" max="300">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Signo</label>
                                <select name="signo_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="aries">√Åries</option>
                                    <option value="touro">Touro</option>
                                    <option value="gemeos">G√™meos</option>
                                    <option value="cancer">C√¢ncer</option>
                                    <option value="leao">Le√£o</option>
                                    <option value="virgem">Virgem</option>
                                    <option value="libra">Libra</option>
                                    <option value="escorpiao">Escorpi√£o</option>
                                    <option value="sagitario">Sagit√°rio</option>
                                    <option value="capricornio">Capric√≥rnio</option>
                                    <option value="aquario">Aqu√°rio</option>
                                    <option value="peixes">Peixes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Estado Civil</label>
                                <select name="estado_civil_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="solteiro">Solteiro(a)</option>
                                    <option value="namorando">Namorando</option>
                                    <option value="casado">Casado(a)</option>
                                    <option value="uniao_estavel">Uni√£o Est√°vel</option>
                                    <option value="divorciado">Divorciado(a)</option>
                                    <option value="viuvo">Vi√∫vo(a)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Etnia</label>
                                <select name="etnia_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="branco">Branco</option>
                                    <option value="negro">Negro</option>
                                    <option value="pardo">Pardo</option>
                                    <option value="amarelo">Amarelo</option>
                                    <option value="indigena">Ind√≠gena</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Cabelos</label>
                                <select name="cabelos_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="pretos_curto">Pretos (curto)</option>
                                    <option value="pretos_medio">Pretos (m√©dio)</option>
                                    <option value="pretos_longo">Pretos (longo)</option>
                                    <option value="castanhos_curto">Castanhos (curto)</option>
                                    <option value="castanhos_medio">Castanhos (m√©dio)</option>
                                    <option value="castanhos_longo">Castanhos (longo)</option>
                                    <option value="loiros_curto">Loiros (curto)</option>
                                    <option value="loiros_medio">Loiros (m√©dio)</option>
                                    <option value="loiros_longo">Loiros (longo)</option>
                                    <option value="ruivos_curto">Ruivos (curto)</option>
                                    <option value="ruivos_medio">Ruivos (m√©dio)</option>
                                    <option value="ruivos_longo">Ruivos (longo)</option>
                                    <option value="careca">Careca</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Olhos</label>
                                <select name="olhos_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="pretos">Pretos</option>
                                    <option value="castanhos">Castanhos</option>
                                    <option value="azuis">Azuis</option>
                                    <option value="verdes">Verdes</option>
                                    <option value="cinzas">Cinzas</option>
                                    <option value="mel">Mel</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Tipo de Corpo</label>
                                <select name="tipo_corpo_ele" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="magro">Magro</option>
                                    <option value="atletico">Atl√©tico</option>
                                    <option value="normal">Normal</option>
                                    <option value="acima_peso">Acima do peso</option>
                                    <option value="musculoso">Musculoso</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Fumante</label>
                                <select name="fumante_ele" class="form-control">
                                    <option value="nao">N√£o</option>
                                    <option value="sim">Sim</option>
                                    <option value="ocasionalmente">Ocasionalmente</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Bebe</label>
                                <select name="bebe_ele" class="form-control">
                                    <option value="nao">N√£o</option>
                                    <option value="sim">Sim</option>
                                    <option value="socialmente">Socialmente</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o Pessoal</label>
                                <textarea name="descricao_ele" class="form-control" rows="3" placeholder="Como se define em poucas palavras?"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Painel para Ela -->
                <div id="painel-ela" class="person-panel">
                    <h3>üë© Dados Pessoais - Ela</h3>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Nome / Apelido</label>
                                <input type="text" name="nome_ela" class="form-control" placeholder="Nome ou apelido p√∫blico">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Data de Nascimento</label>
                                <input type="date" name="data_nascimento_ela" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Profiss√£o</label>
                                <input type="text" name="profissao_ela" class="form-control" placeholder="Sua profiss√£o">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Orienta√ß√£o Sexual</label>
                                <select name="orientacao_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="heterossexual">Heterossexual</option>
                                    <option value="bissexual">Bissexual</option>
                                    <option value="homossexual">Homossexual</option>
                                    <option value="pansexual">Pansexual</option>
                                    <option value="assexual">Assexual</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Altura (cm)</label>
                                <input type="number" name="altura_ela" class="form-control" placeholder="Ex: 165" min="100" max="250">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Peso (kg)</label>
                                <input type="number" name="peso_ela" class="form-control" placeholder="Ex: 60" min="30" max="300">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">Signo</label>
                                <select name="signo_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="aries">√Åries</option>
                                    <option value="touro">Touro</option>
                                    <option value="gemeos">G√™meos</option>
                                    <option value="cancer">C√¢ncer</option>
                                    <option value="leao">Le√£o</option>
                                    <option value="virgem">Virgem</option>
                                    <option value="libra">Libra</option>
                                    <option value="escorpiao">Escorpi√£o</option>
                                    <option value="sagitario">Sagit√°rio</option>
                                    <option value="capricornio">Capric√≥rnio</option>
                                    <option value="aquario">Aqu√°rio</option>
                                    <option value="peixes">Peixes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Estado Civil</label>
                                <select name="estado_civil_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="solteiro">Solteiro(a)</option>
                                    <option value="namorando">Namorando</option>
                                    <option value="casado">Casado(a)</option>
                                    <option value="uniao_estavel">Uni√£o Est√°vel</option>
                                    <option value="divorciado">Divorciado(a)</option>
                                    <option value="viuvo">Vi√∫vo(a)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Etnia</label>
                                <select name="etnia_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="branco">Branco</option>
                                    <option value="negro">Negro</option>
                                    <option value="pardo">Pardo</option>
                                    <option value="amarelo">Amarelo</option>
                                    <option value="indigena">Ind√≠gena</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Cabelos</label>
                                <select name="cabelos_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="pretos_curto">Pretos (curto)</option>
                                    <option value="pretos_medio">Pretos (m√©dio)</option>
                                    <option value="pretos_longo">Pretos (longo)</option>
                                    <option value="castanhos_curto">Castanhos (curto)</option>
                                    <option value="castanhos_medio">Castanhos (m√©dio)</option>
                                    <option value="castanhos_longo">Castanhos (longo)</option>
                                    <option value="loiros_curto">Loiros (curto)</option>
                                    <option value="loiros_medio">Loiros (m√©dio)</option>
                                    <option value="loiros_longo">Loiros (longo)</option>
                                    <option value="ruivos_curto">Ruivos (curto)</option>
                                    <option value="ruivos_medio">Ruivos (m√©dio)</option>
                                    <option value="ruivos_longo">Ruivos (longo)</option>
                                    <option value="careca">Careca</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Olhos</label>
                                <select name="olhos_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="pretos">Pretos</option>
                                    <option value="castanhos">Castanhos</option>
                                    <option value="azuis">Azuis</option>
                                    <option value="verdes">Verdes</option>
                                    <option value="cinzas">Cinzas</option>
                                    <option value="mel">Mel</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Tipo de Corpo</label>
                                <select name="tipo_corpo_ela" class="form-control">
                                    <option value="">Selecione</option>
                                    <option value="magro">Magro</option>
                                    <option value="atletico">Atl√©tico</option>
                                    <option value="normal">Normal</option>
                                    <option value="acima_peso">Acima do peso</option>
                                    <option value="musculoso">Musculoso</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Fumante</label>
                                <select name="fumante_ela" class="form-control">
                                    <option value="nao">N√£o</option>
                                    <option value="sim">Sim</option>
                                    <option value="ocasionalmente">Ocasionalmente</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Bebe</label>
                                <select name="bebe_ela" class="form-control">
                                    <option value="nao">N√£o</option>
                                    <option value="sim">Sim</option>
                                    <option value="socialmente">Socialmente</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o Pessoal</label>
                                <textarea name="descricao_ela" class="form-control" rows="3" placeholder="Como se define em poucas palavras?"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Interesses -->
            <div id="interesses" class="tab-content">
                <h2>Interesses e Prefer√™ncias</h2>
                
                <!-- Procurando por -->
                <div class="interest-section">
                    <h3>üîç Procurando por</h3>
                    <div class="interest-grid">
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_casais" value="casais">
                            <span class="interest-label">üë´ Casais</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_mulheres" value="mulheres">
                            <span class="interest-label">üë© Mulheres</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_homens" value="homens">
                            <span class="interest-label">üë® Homens</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_grupos" value="grupos">
                            <span class="interest-label">üë• Grupos</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_amizades" value="amizades">
                            <span class="interest-label">ü§ù Amizades</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="procurando_experiencias" value="experiencias">
                            <span class="interest-label">üåü Experi√™ncias</span>
                        </label>
                    </div>
                </div>
                
                <!-- Objetivos -->
                <div class="interest-section">
                    <h3>üéØ Objetivos</h3>
                    <div class="interest-grid">
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_amizades" value="amizades">
                            <span class="interest-label">üí¨ Amizades</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_relacionamento" value="relacionamento">
                            <span class="interest-label">üíï Relacionamento</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_troca" value="troca">
                            <span class="interest-label">üîÑ Troca de casais</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_aventura" value="aventura">
                            <span class="interest-label">üé™ Aventura</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_relacao_aberta" value="relacao_aberta">
                            <span class="interest-label">üîì Rela√ß√£o aberta</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="objetivo_curiosidade" value="curiosidade">
                            <span class="interest-label">üîç Curiosidade</span>
                        </label>
                    </div>
                </div>
                
                <!-- Prefer√™ncias -->
                <div class="interest-section">
                    <h3>üí´ Prefer√™ncias e Afinidades</h3>
                    <div class="interest-grid">
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_romantico" value="romantico">
                            <span class="interest-label">üåπ Rom√¢ntico</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_aventureiro" value="aventureiro">
                            <span class="interest-label">üèîÔ∏è Aventureiro</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_intimista" value="intimista">
                            <span class="interest-label">üïØÔ∏è Intimista</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_social" value="social">
                            <span class="interest-label">üéâ Social</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_privacidade" value="privacidade">
                            <span class="interest-label">üîí Privacidade</span>
                        </label>
                        <label class="interest-item">
                            <input type="checkbox" name="preferencia_publico" value="publico">
                            <span class="interest-label">üåê P√∫blico</span>
                        </label>
                    </div>
                </div>
                
                <!-- N√≠vel de abertura -->
                <div class="interest-section">
                    <h3>üîì N√≠vel de Abertura</h3>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="nivel_abertura" value="conservador">
                            <span class="radio-label">üîí Conservador</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="nivel_abertura" value="moderado">
                            <span class="radio-label">üîì Moderado</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="nivel_abertura" value="aberto">
                            <span class="radio-label">üîì Aberto</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="nivel_abertura" value="muito_aberto">
                            <span class="radio-label">üîìüîì Muito Aberto</span>
                        </label>
                    </div>
                </div>
                
                <!-- Checkbox de idade -->
                <div class="interest-section">
                    <label class="checkbox-item">
                        <input type="checkbox" name="maior_18" value="sim" checked>
                        <span class="checkbox-label">üîû Confirmo que sou maior de 18 anos</span>
                    </label>
                </div>
            </div>

            <!-- Aba Sobre -->
            <div id="sobre" class="tab-content">
                <h2>Sobre N√≥s</h2>
                
                <!-- Quem somos -->
                <div class="about-section">
                    <h3>üë• Quem Somos</h3>
                    <div class="form-group">
                        <label class="form-label">Apresenta√ß√£o do Casal</label>
                        <textarea name="quem_somos" class="form-control" rows="4" 
                                placeholder="Conte quem voc√™s s√£o, como se conheceram, o que os une..."></textarea>
                        <small class="form-text">M√°ximo 500 caracteres</small>
                    </div>
                </div>
                
                <!-- O que nos inspira -->
                <div class="about-section">
                    <h3>‚ú® O que nos inspira</h3>
                    <div class="form-group">
                        <label class="form-label">Nossos Valores e Inspira√ß√µes</label>
                        <textarea name="inspiracao" class="form-control" rows="3" 
                                placeholder="O que voc√™s buscam, o que os inspira, seus valores..."></textarea>
                        <small class="form-text">M√°ximo 300 caracteres</small>
                    </div>
                </div>
                
                <!-- Frase de destaque -->
                <div class="about-section">
                    <h3>üí¨ Frase de Destaque</h3>
                    <div class="form-group">
                        <label class="form-label">Frase que nos representa</label>
                        <input type="text" name="frase_destaque" class="form-control" 
                               placeholder="Uma frase que define voc√™s como casal" maxlength="100">
                        <small class="form-text">Esta frase aparecer√° na capa do perfil</small>
                    </div>
                </div>
                
                <!-- Links externos -->
                <div class="about-section">
                    <h3>üîó Links Externos (Opcional)</h3>
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Instagram</label>
                                <input type="url" name="instagram" class="form-control" 
                                       placeholder="@usuario ou link completo">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Outro Link</label>
                                <input type="url" name="outro_link" class="form-control" 
                                       placeholder="Site, blog, etc.">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bio individual (para casais) -->
                <div id="bio-individual" class="about-section" style="display: none;">
                    <h3>üë§ Biografias Individuais</h3>
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Bio - Ele</label>
                                <textarea name="bio_ele" class="form-control" rows="3" 
                                        placeholder="Conte sobre ele..."></textarea>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">Bio - Ela</label>
                                <textarea name="bio_ela" class="form-control" rows="3" 
                                        placeholder="Conte sobre ela..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bio individual (para pessoas solteiras) -->
                <div id="bio-solteiro" class="about-section">
                    <h3>üë§ Minha Hist√≥ria</h3>
                    <div class="form-group">
                        <label class="form-label">Sua Biografia</label>
                        <textarea name="bio_individual" class="form-control" rows="4" 
                                placeholder="Conte sua hist√≥ria, seus interesses, o que te move..."></textarea>
                        <small class="form-text">M√°ximo 400 caracteres</small>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Bot√£o Salvar -->
<button class="save-btn" onclick="document.querySelector('form').submit()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
    </svg>
    Salvar
</button>

<script>
// Fun√ß√£o para preview do avatar
function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarContainer = document.querySelector('.avatar-container');
            const existingImg = avatarContainer.querySelector('.avatar-image');
            const placeholder = avatarContainer.querySelector('.avatar-placeholder');
            
            if (existingImg) {
                existingImg.src = e.target.result;
            } else if (placeholder) {
                placeholder.style.display = 'none';
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'avatar-image';
                img.alt = 'Avatar';
                avatarContainer.insertBefore(img, placeholder);
            }
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Sistema de Abas SIMPLES
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Remover active de todos
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Ativar selecionado
            this.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
        });
    });
    
           // Controle do tipo de perfil
           const tipoPerfilSelect = document.getElementById('tipo-perfil-select');
           const relacionamentoSection = document.getElementById('relacionamento-section');
           const coupleTabsControl = document.getElementById('couple-tabs-control');
           
           function toggleRelacionamentoSection() {
               const tipoPerfil = tipoPerfilSelect.value;
               const bioIndividual = document.getElementById('bio-individual');
               const bioSolteiro = document.getElementById('bio-solteiro');
               
               if (tipoPerfil && tipoPerfil.startsWith('casal_')) {
                   relacionamentoSection.style.display = 'block';
                   coupleTabsControl.style.display = 'block';
                   bioIndividual.style.display = 'block';
                   bioSolteiro.style.display = 'none';
               } else {
                   relacionamentoSection.style.display = 'none';
                   coupleTabsControl.style.display = 'none';
                   bioIndividual.style.display = 'none';
                   bioSolteiro.style.display = 'block';
               }
           }
           
           tipoPerfilSelect.addEventListener('change', toggleRelacionamentoSection);
           toggleRelacionamentoSection(); // Executar na inicializa√ß√£o
           
           // Controle das abas internas (Ele/Ela)
           const internalTabBtns = document.querySelectorAll('.internal-tab-btn');
           const personPanels = document.querySelectorAll('.person-panel');
           
           internalTabBtns.forEach(btn => {
               btn.addEventListener('click', function(e) {
                   e.preventDefault(); // Prevenir comportamento padr√£o
                   e.stopPropagation(); // Parar propaga√ß√£o do evento
                   
                   const targetPerson = this.getAttribute('data-person');
                   
                   // Remover active de todos
                   internalTabBtns.forEach(b => b.classList.remove('active'));
                   personPanels.forEach(p => p.classList.remove('active'));
                   
                   // Ativar selecionado
                   this.classList.add('active');
                   document.getElementById(`painel-${targetPerson}`).classList.add('active');
               });
           });
    
    // Autocomplete para cidades
    const cidadeInput = document.getElementById('cidade-input');
    const suggestionsDiv = document.getElementById('suggestions');
    
    let cidades = [];
    let selectedCity = null;
    
    // Carregar cidades da API
    fetch('/usuarios/api/cidades/')
        .then(response => response.json())
        .then(data => {
            cidades = data;
            console.log('Cidades carregadas:', cidades.length);
        })
        .catch(error => {
            console.error('Erro ao carregar cidades:', error);
        });
    
    function showSuggestions(cities) {
        suggestionsDiv.innerHTML = '';
        
        if (cities.length === 0) {
            suggestionsDiv.style.display = 'none';
            return;
        }
        
        cities.forEach(city => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.innerHTML = `
                <span class="suggestion-city">${city.nome}</span>
                <span class="suggestion-state">${city.estado}</span>
            `;
            
            item.addEventListener('click', function() {
                selectCity(city);
            });
            
            suggestionsDiv.appendChild(item);
        });
        
        suggestionsDiv.style.display = 'block';
    }
    
    function selectCity(city) {
        selectedCity = city;
        cidadeInput.value = city.nome_completo;
        
        // Preencher campos hidden
        document.getElementById('cidade_nome').value = city.nome;
        document.getElementById('estado').value = city.estado;
        document.getElementById('cidade_ref').value = city.id;
        
        suggestionsDiv.style.display = 'none';
    }
    
    function searchCities(query) {
        if (query.length < 2) {
            suggestionsDiv.style.display = 'none';
            selectedCity = null;
            return;
        }
        
        const queryLower = query.toLowerCase();
        const filtered = cidades.filter(city => 
            city.nome.toLowerCase().includes(queryLower) ||
            city.estado.toLowerCase().includes(queryLower) ||
            city.nome_completo.toLowerCase().includes(queryLower)
        );
        
        showSuggestions(filtered.slice(0, 10)); // Limitar a 10 resultados
    }
    
    // Event listeners para cidade
    cidadeInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        // Reset selection if user types something different
        if (selectedCity && !this.value.includes(selectedCity.nome)) {
            selectedCity = null;
            document.getElementById('cidade_nome').value = '';
            document.getElementById('estado').value = '';
            document.getElementById('cidade_ref').value = '';
        }
        
        searchCities(query);
    });
    
    cidadeInput.addEventListener('focus', function() {
        if (this.value.trim().length >= 2) {
            searchCities(this.value.trim());
        }
    });
    
    // Hide suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (!cidadeInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
            suggestionsDiv.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
